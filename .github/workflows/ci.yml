# Nome do workflow que aparecerá na aba "Actions" do GitHub
name: Pipeline de Verificação e Qualidade

on:
  push:
  pull_request:
  workflow_dispatch:

jobs:
  verificacao:
    name: Verificação de Qualidade
    runs-on: ubuntu-latest
    steps:
      # Passo 1: Baixa o código do seu repositório
      - name: 1. Checkout do código
        uses: actions/checkout@v4

      # Passo 2: Valida o HTML
      - name: 2. Validar sintaxe do HTML
        uses: Cyb3r-Jak3/html5validator-action@v7.2.0
        with:
          root: ./

      # Passo 2.1: Salva o arquivo de log da validação
      - name: 2.1 Salvar log de validação HTML
        uses: actions/upload-artifact@v4
        with:
          name: log-validacao-html
          path: log.log

      # Passo 3: Verifica se existem links quebrados no seu site
      - name: 3. Verificar links quebrados
        uses: lycheeverse/lychee-action@v1
        with:
          args: --verbose

      # Passo 4: Roda o Prettier para FORMATAR os arquivos
      - name: 4. Formata o código com Prettier
        uses: creyD/prettier_action@v4.3
        with:
          # A opção '--write' efetivamente corrige/formata os arquivos
          prettier_options: --write .

      # Passo 5: Cria um commit APENAS SE o passo anterior alterou algum arquivo
      - name: 5. Cria commit com as correções de formatação, se houver
        uses: stefanzweifel/git-auto-commit-action@v5
        with:
          commit_message: "style: Formata código automaticamente com Prettier"
          commit_user_name: "GitHub Actions Bot"
          commit_user_email: "actions@github.com"
          commit_author: "GitHub Actions Bot <actions@github.com>"
